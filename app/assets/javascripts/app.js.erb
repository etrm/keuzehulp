var models = <%= Model.all.map(&:as_json).to_json %>;

function getCriteria () {
  var selected = [];
  $('input:checked').each(function() {
    selected.push($(this).attr('name'));
  });
  return selected;
}

function updateScores () {
  var criteria = getCriteria();

  $.each(models, function(){
    this.score = calculateScore(criteria, this.properties);
    $("#" + this.key + "_score").html(toPercentageString(this.score));
  });
}

// Calculated score by comparing list of user 'wished' properties
// with the properties defined by the model.
function calculateScore(userProperties, modelProperties) {
  if (userProperties.length == 0) {
    return 0;
  }
  var matches = 0;
  for (var i = 0; i < userProperties.length; i++) {
    if ($.inArray(userProperties[i], modelProperties) > -1) {
      matches++;
    }
  }
  return matches / userProperties.length;
};

function toPercentageString(number) {
  return (number*100).toFixed(2) + "%";
}

$(document).ready(function(){
  $('input:checkbox').change(function() {
    updateScores();
  });

  $(document).ready(function(){
    $("#output table").sticky({topSpacing:0});
  });
});
